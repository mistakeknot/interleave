# Roadmap Generation Walkthrough

An annotated walkthrough of the interleave pattern applied to the Interverse monorepo roadmap.

## Data Sources

The template script (`scripts/template-roadmap-md.sh`) reads from two data sources:

1. **`docs/roadmap.json`** — Machine-readable monorepo state generated by `sync-roadmap-json.sh`. Contains module metadata, version numbers, status, open bead counts, module highlights, research agenda items, and cross-module dependencies.

2. **`bd --json` queries** — Live beads data: open issues by priority (P0-P4), recently closed issues, blocked issues, and project statistics. Falls back to `roadmap.json` counts when `bd` is unavailable.

## Section-by-Section Classification

| # | Section | Type | Source | Rendered By |
|---|---------|------|--------|-------------|
| 1 | Header (module count, open beads, date) | Deterministic | roadmap.json, `date` | Script |
| 2 | Ecosystem Snapshot table | Deterministic | roadmap.json `.modules[]` | Script (jq) |
| 3 | Now (P0-P1) item list | Deterministic | `bd --json list --priority=0,1` | Script |
| 4 | Recently Completed | Deterministic | `bd --json list --status=closed` | Script |
| 5 | **Next (P2) groupings** | **Semantic** | `bd --json list --priority=2` | **LLM placeholder** |
| 6 | Later (P3+) item list | Deterministic | `bd --json list --priority=3,4` | Script |
| 7 | **Module Highlights** | **Hybrid** | roadmap.json `.module_highlights[]` | Script + **LLM placeholder** |
| 8 | **Research Agenda** | **Semantic** | brainstorm/plan file titles, roadmap.json `.research_agenda[]` | **LLM placeholder** |
| 9 | Cross-Module Dependencies | Deterministic | `bd --json blocked` + roadmap.json | Script |
| 10 | Modules Without Roadmaps | Deterministic | roadmap.json `.modules_without_roadmaps[]` | Script |
| 11 | Keeping Current | Deterministic | Static text | Script (heredoc) |

**Result:** 8 deterministic sections, 2 semantic, 1 hybrid → ~70% deterministic.

## The 3 LLM Islands

### NEXT_GROUPINGS (Sonnet-class)

**Why Sonnet:** Thematic clustering of 30-60 items requires judgment about what "belongs together." Haiku tends to create too many single-item groups or mechanically group by module tag alone.

**Embedded context:** JSON array of P2 items with `{id, title, priority, dependencies}`. The Task instructs grouping under 5-10 thematic headings, with a heuristic hint that shared module tags or dependency chains suggest grouping.

**Output format:** Bold headings with bullet items using `- [module] **id** title` format.

### MODULE_HIGHLIGHTS (Haiku-class)

**Why Haiku:** Factual summarization from item titles. The template renders modules that already have summaries >40 characters in `roadmap.json`; only modules with missing or stale summaries are sent to the LLM.

**Embedded context:** List of `module|location` pairs needing highlights.

**Output format:** `### module (location)` heading followed by 2-3 sentence summary.

### RESEARCH_AGENDA (Haiku-class)

**Why Haiku:** Synthesis from file title lists — pattern matching, not deep reasoning. The titles of brainstorm and plan documents are explicit enough that Haiku can group them thematically.

**Embedded context:** Brainstorm file basenames, plan file basenames, existing research agenda items from `roadmap.json`.

**Output format:** `- **Topic** — 1-line summary` bullets.

## Token Savings Breakdown

| Component | Estimated Tokens |
|-----------|-----------------|
| Full LLM regeneration (baseline) | ~15,000 |
| Template script output (deterministic, free) | ~10,000 |
| NEXT_GROUPINGS island (Sonnet input+output) | ~1,400 |
| MODULE_HIGHLIGHTS island (Haiku input+output) | ~700 |
| RESEARCH_AGENDA island (Haiku input+output) | ~700 |
| **Total LLM cost with interleave** | **~2,800** |
| **Savings vs. full regeneration** | **~12,200 (81%)** |

The savings ratio is ~0.67 (deterministic tokens / total tokens), well above the 0.60 threshold.

## Placeholder Format Example

Before filling (invisible in markdown renderers):

```markdown
### Next (P2)

<!-- LLM:NEXT_GROUPINGS
Task: Group these P2 items under 5-10 thematic headings.
Format: **Bold Heading** followed by bullet items.
Heuristic: items sharing a [module] tag or dependency chain likely belong together.

Raw P2 items JSON:
[{"id":"beads-abc","title":"[interflux] Add domain cache TTL","priority":2,"dependencies":[]},...]

END LLM:NEXT_GROUPINGS -->
```

After filling:

```markdown
### Next (P2)

**Multi-Agent Review**
- [interflux] **beads-abc** Add domain cache TTL
- [interflux] **beads-def** Implement knowledge decay

**Plugin Infrastructure**
- [interdev] **beads-ghi** Scaffold new plugin template
- [interpub] **beads-jkl** Automate marketplace submission
```
